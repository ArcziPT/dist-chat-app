(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{44:function(e,n,t){},45:function(e,n,t){},75:function(e,n,t){},79:function(e,n,t){"use strict";t.r(n);var s=t(0),c=t.n(s),a=t(19),r=t.n(a),i=(t(44),t(45),t(18)),o=t(3),u=t(17),l=function(){return Object(u.b)()},d=u.c,j=t(13),h=t(11),f=t.n(h),b=t(16),O=t(9),p=t(12),v=t.n(p),g=Object(O.b)("messages/get",function(){var e=Object(b.a)(f.a.mark((function e(n){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s=n.channelId,c=n.timestamp,a=n.amount,v.a.get("/channels/".concat(s,"/messages?timestamp=").concat(c,"&number=").concat(a));case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}var s,c,a}),e)})));return function(n){return e.apply(this,arguments)}}()),x=Object(O.c)({name:"messages",initialState:{},reducers:{addMessage:function(e,n){e.hasOwnProperty(n.payload.channelId)?e[n.payload.channelId].push(n.payload.msg):e[n.payload.channelId]=[n.payload.msg]}},extraReducers:function(e){e.addCase(g.fulfilled,(function(e,n){if(n.payload.length>0){var t=n.payload[0].channelId.toString();e.hasOwnProperty(t)?(e[t].concat(n.payload),e[t]=e[t].sort((function(e,n){return e.timestamp-n.timestamp}))):e[t]=n.payload}}))}}),m=x.actions.addMessage,y=x.reducer,I=t(28),w=function(e){return v.a.post("/auth",e)},k={status:"none",token:null,user:null,servers:[],connection:null},S=Object(O.b)("session/login",function(){var e=Object(b.a)(f.a.mark((function e(n){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(n);case 2:return t=e.sent,e.abrupt("return",Object(I.a)(Object(I.a)({},t.data),{},{token:t.headers.authorization}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),C=Object(O.b)("session/getChannels",Object(b.a)(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("/users/channels");case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))),E=Object(O.c)({name:"session",initialState:k,reducers:{logoutAction:function(e){e.user=k.user,e.token=k.token,e.status=k.status,e.servers=k.servers,e.connection=k.connection}},extraReducers:function(e){e.addCase(S.pending,(function(e){e.status="loading"})).addCase(S.fulfilled,(function(e,n){null!=n.payload&&(e.status="active",e.user={username:n.payload.username,id:n.payload.userId},e.token=n.payload.token)})).addCase(C.fulfilled,(function(e,n){e.servers=n.payload}))}}),P=E.actions.logoutAction,N=E.reducer,D=t(25),M=t.n(D),J=(t(75),t(1)),L=function(){var e=d((function(e){return e.session.status})),n=Object(o.f)(),t=l(),c=d((function(e){return e.session.token})),a=Object(s.useState)(0),r=Object(j.a)(a,2),i=r[0],u=r[1],h=Object(s.useState)(0),f=Object(j.a)(h,2),b=f[0],O=f[1],p=Object(s.useState)(""),v=Object(j.a)(p,2),x=v[0],y=v[1],I=d((function(e){return e.session.servers})),w=d((function(e){return e.messages})),k=window.location.href,S="ws".concat(k.substring(4,k.length-4),"connect"),E=M()(S),P=E.sendMessage,N=E.lastMessage,L=E.readyState;if(Object(s.useEffect)((function(){if(0!=I.length){var e=I[i].serverId;P(JSON.stringify({type:"change",msg:{serverId:e}}))}}),[i]),Object(s.useEffect)((function(){I.length>0&&L==D.ReadyState.OPEN&&P(JSON.stringify({token:c,serverId:I[i].serverId}))}),[I,L]),Object(s.useEffect)((function(){if(null!=N){var e=JSON.parse(null===N||void 0===N?void 0:N.data);e.hasOwnProperty("status")?console.log("ready"):t(m({channelId:e.channelId,msg:e}))}}),[N]),Object(s.useEffect)((function(){t(C())}),[]),Object(s.useEffect)((function(){if(console.log("effect"),0!=I.length){var e=I[i].channels[b].channelId;w.hasOwnProperty(e)&&0!=w[e].length||t(g({channelId:e,timestamp:Date.now(),amount:20}))}})),0==I.length)return Object(J.jsx)("div",{children:"Loading"});var A=I[i].channels,H=[],R=I[i].channels[b].channelId;w.hasOwnProperty(R)&&(H=w[R.toString()]);var W=H,z=function(e){return function(){var n=I.findIndex((function(n){return n.serverId==e}));u(n),O(0)}},B=function(e){return function(){var n=A.findIndex((function(n){return n.channelId==e}));O(n)}},T=function(e){var n=new Date(e),t=n.getHours(),s="0"+n.getMinutes(),c="0"+n.getSeconds(),a=n.getFullYear(),r=n.getMonth();return n.getDay()+"/"+r+"/"+a+" "+t+":"+s.substr(-2)+":"+c.substr(-2)};"active"!=e&&n.push("/login");var q=I[i].serverId,F=I[i].channels[b].channelId;return Object(J.jsxs)("div",{children:[Object(J.jsx)("div",{className:"serverPanel",children:I.map((function(e){return Object(J.jsxs)("div",{children:[Object(J.jsx)("p",{children:e.name}),Object(J.jsx)("button",{onClick:z(e.serverId),children:e.serverId==q?"":"SELECT"})]},e.serverId)}))}),Object(J.jsx)("div",{className:"channelsPanel",children:A.map((function(e){return Object(J.jsxs)("div",{children:[Object(J.jsx)("p",{children:e.name}),Object(J.jsx)("button",{onClick:B(e.channelId),children:e.channelId==F?"":"SELECT"})]},e.channelId)}))}),Object(J.jsxs)("div",{className:"chat",children:[W.map((function(e){return Object(J.jsx)("div",{children:Object(J.jsxs)("p",{children:["[",T(e.timestamp),"] ",e.username,": ",e.text]})},e.userId*e.timestamp)})),Object(J.jsxs)("form",{children:[Object(J.jsx)("p",{children:"Message:"}),Object(J.jsx)("input",{type:"text",onChange:function(e){e.preventDefault(),y(e.target.value)}})]}),Object(J.jsx)("button",{onClick:function(){var e=I[i].channels[b].channelId;P(JSON.stringify({type:"send",msg:{timestamp:Date.now(),text:x,channelId:e}})),y("")},children:"SEND"})]})]})},A=function(){var e=Object(s.useState)(""),n=Object(j.a)(e,2),t=n[0],c=n[1],a=Object(s.useState)(""),r=Object(j.a)(a,2),i=r[0],u=r[1],h=l(),f=Object(o.f)(),b=d((function(e){return e.session.status}));"active"==b&&f.push("/chat");return Object(J.jsxs)("div",{children:["Status: ",b,Object(J.jsxs)("form",{children:[Object(J.jsx)("p",{children:"Username:"}),Object(J.jsx)("input",{type:"text",onChange:function(e){e.preventDefault(),c(e.target.value)}}),Object(J.jsx)("p",{children:"Password:"}),Object(J.jsx)("input",{type:"password",onChange:function(e){e.preventDefault(),u(e.target.value)}})]}),Object(J.jsx)("button",{onClick:function(){h(S({username:t,password:i}))},children:"Login"})]})},H=function(){return Object(J.jsx)("div",{children:"Home"})};var R=function(){var e=d((function(e){var n;return null===(n=e.session.user)||void 0===n?void 0:n.username})),n=d((function(e){return e.session.status})),t=d((function(e){return e.session.token})),s=l();return null!=t&&v.a.interceptors.request.use((function(e){return e.headers.Authorization=t,e}),(function(e){return Promise.reject(e)})),Object(J.jsx)(i.a,{children:Object(J.jsxs)("div",{children:[Object(J.jsx)("nav",{children:Object(J.jsxs)("ul",{children:[Object(J.jsx)("li",{children:Object(J.jsx)(i.b,{to:"/",children:"Home"})}),Object(J.jsx)("li",{children:Object(J.jsx)(i.b,{to:"/chat",children:"Chat"})}),"none"==n&&Object(J.jsx)("li",{children:Object(J.jsx)(i.b,{to:"/login",children:"Login"})}),"active"==n&&Object(J.jsxs)("li",{children:["Witaj, ",e]}),"active"==n&&Object(J.jsx)("li",{children:Object(J.jsx)("button",{onClick:function(){s(P())},children:"Logout"})})]})}),Object(J.jsxs)(o.c,{children:[Object(J.jsx)(o.a,{path:"/chat",children:Object(J.jsx)(L,{})}),Object(J.jsx)(o.a,{path:"/login",children:Object(J.jsx)(A,{})}),Object(J.jsx)(o.a,{path:"/",children:Object(J.jsx)(H,{})})]})]})})},W=Object(O.a)({reducer:{session:N,messages:y}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(J.jsx)(c.a.StrictMode,{children:Object(J.jsx)(u.a,{store:W,children:Object(J.jsx)(R,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[79,1,2]]]);
//# sourceMappingURL=main.dc47f1b0.chunk.js.map